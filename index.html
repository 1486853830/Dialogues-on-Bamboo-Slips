<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>键谈星霜·梦溯华胥</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background: url('background.png') center/cover no-repeat fixed;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            position: relative;
        }

        /* 添加毛玻璃遮罩层 */
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(8px);
            z-index: -1;
        }

        h1 {
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }

        .agents-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            padding: 0 20px;
        }

        @media (max-width: 768px) {
            .agents-container {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        @media (max-width: 480px) {
            .agents-container {
                grid-template-columns: 1fr;
            }
        }

        .agent-card {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.25, 0.8, 0.25, 1);
            /* 更平滑的过渡曲线 */
            will-change: transform, box-shadow;
            /* 优化性能 */
        }

        /* 添加发光边缘效果 */
        .agent-card::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 16px;
            box-shadow: inset 0 0 10px rgba(255, 255, 255, 0.3);
            pointer-events: none;
        }

        .agent-card:hover {
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15),
                0 0 20px rgba(255, 255, 255, 0.5);
            /* 悬停时增强柔光 */
        }

        .agent-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 10px;
            border: 3px solid white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .agent-name {
            font-weight: bold;
            font-size: 16px;
            margin: 10px 0 5px;
        }

        .agent-desc {
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<!-- 在body标签内添加设置按钮 -->

<body>
    <!-- 添加设置按钮 -->
    <div class="settings-btn" onclick="toggleSettings()">
        ⚙️
    </div>

    <!-- 添加设置弹窗 -->
    <!-- 修改设置弹窗内容 -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <h2>系统设置</h2>
            <div class="settings-item">
                <label for="apiKey">API密钥（仅支持DeepSeek-API）：</label>
                <input type="password" id="apiKey" placeholder="输入您的API密钥">
            </div>
            <!-- 新增聊天记录管理选项 -->
            <!-- 修改设置弹窗中的聊天记录管理按钮 -->
            <div class="settings-item">
                <label>聊天记录管理：</label>
                <button onclick="manageChatHistory()" class="settings-btn-secondary">
                    管理聊天记录
                </button>
            </div>

            <!-- 在设置弹窗中添加音乐控制 -->
            <div class="settings-item">
                <label>背景音乐（暂不支持切换）：</label>
                <div style="display: flex; gap: 10px; margin-top: 8px;">
                    <select id="bgm-select" class="settings-btn-secondary">
                        <option value="">无</option>
                    </select>
                    <button id="bgm-toggle" class="settings-btn-secondary" style="width: 80px;">关闭</button>
                </div>
            </div>

            <!-- 修改按钮样式 -->
            <style>
                .settings-btn-secondary {
                    width: 100%;
                    margin-top: 8px;
                    padding: 12px;
                    background: rgba(255, 255, 255, 0.1);
                    /* 与API密钥输入框相同的底色 */
                    color: white;
                    border: 1px solid rgba(255, 255, 255, 0.2);
                    /* 与API密钥输入框相同的边框 */
                    border-radius: 8px;
                    cursor: pointer;
                    font-weight: 500;
                    font-size: 16px;
                    /* 增大字体大小 */
                    transition: all 0.3s ease;
                    backdrop-filter: blur(5px);
                }

                .settings-btn-secondary:hover {
                    background: rgba(255, 255, 255, 0.15);
                    /* 悬停时稍微加深 */
                    transform: translateY(-2px);
                }

                .settings-btn-secondary:active {
                    transform: translateY(0);
                }
            </style>
            <div class="settings-actions">
                <button onclick="saveSettings()">保存设置</button>
            </div>
        </div>
    </div>
    <h1>键谈星霜·梦溯华胥</h1>
    <div class="agents-container">
        <div class="agent-card" onclick="location.href='孔子/kongzi.html'">
            <img src="孔子/kongzihead.png" class="agent-avatar" alt="孔子">
            <div class="agent-name">孔子</div>
            <div class="agent-desc">孔子，名丘，字仲尼，春秋时期鲁国陬邑人，祖籍宋国栗邑。中国古代思想家、政治家、教育家，儒家学派创始人。</div>
        </div>

        <div class="agent-card" onclick="location.href='霍去病/huoqubing.html'">
            <img src="霍去病/huoqubinghead.png" class="agent-avatar" alt="霍去病">
            <div class="agent-name">霍去病</div>
            <div class="agent-desc">霍去病，河东郡平阳县人，西汉时期名将、军事家、民族英雄。</div>
        </div>

        <div class="agent-card" onclick="location.href='刘邦/liubang.html'">
            <img src="刘邦/liubanghead.png" class="agent-avatar" alt="刘邦">
            <div class="agent-name">刘邦</div>
            <div class="agent-desc">刘邦，字季，沛丰邑中阳里人，中国历史上杰出的政治家、战略家，汉朝开国皇帝</div>
        </div>

        <div class="agent-card" onclick="location.href='赵云/zhaoyun.html'">
            <img src="赵云/zhaoyunhead.png" class="agent-avatar" alt="赵云">
            <div class="agent-name">赵云</div>
            <div class="agent-desc">赵云，字子龙，常山真定人。身长八尺，姿颜雄伟，汉末三国时期蜀汉名将，与关羽、张飞并称“燕南三士”。</div>
        </div>

        <div class="agent-card" onclick="location.href='丘处机/qiuchuji.html'">
            <img src="丘处机/qiuchujihead.png" class="agent-avatar" alt="丘处机">
            <div class="agent-name">丘处机</div>
            <div class="agent-desc">丘处机，金代元初道士，道教全真派“北七真”之一，侠义之士，爱民如子，乐善好施，助人为乐。</div>
        </div>
        <div class="agent-card" onclick="location.href='樊哙/fankuai.html'">
            <img src="樊哙/fankuaihead.png" class="agent-avatar" alt="樊哙">
            <div class="agent-name">樊哙</div>
            <div class="agent-desc">樊哙,泗水郡沛县（今江苏省沛县）人。西汉开国元勋，军事统帅。</div>
        </div>
        <div class="agent-card" onclick="location.href='曹操/caocao.html'">
            <img src="曹操/caocaohead.png" class="agent-avatar" alt="曹操">
            <div class="agent-name">曹操</div>
            <div class="agent-desc">曹操，字孟德，小字阿瞒，沛国谯县人，东汉末年丞相、权臣、政治家、军事家、文学家、诗人、书法家，魏王，曹魏政权奠基者。</div>
        </div>
    </div>
</body>

</html>

<style>
    /* 修改背景遮罩层颜色 */
    body::before {
        background: rgba(0, 0, 0, 0.4);
        /* 从0.2改为0.4增加黑色浓度 */
        backdrop-filter: blur(8px);
    }

    /* 如果需要卡片背景也变深 */
    .agent-card {
        background: rgba(0, 0, 0, 0.3);
        /* 新增深色卡片背景 */
        color: white;
        /* 文字改为白色 */
    }

    .agent-desc {
        color: rgba(255, 255, 255, 0.8);
        /* 描述文字改为浅灰色 */
    }

    /* 调整悬停效果透明度 */
    .agent-card:hover {
        background: rgba(255, 255, 255, 0.7);
        /* 悬停时稍微减少透明度 */
        color: black;
        /* 悬停时文字变黑色 */
    }

    .agent-card:hover .agent-name,
    .agent-card:hover .agent-desc {
        color: black;
        /* 确保名称和描述都变黑 */
    }
</style>

<style>
    /* 添加流星样式 */
    .meteor {
        position: fixed;
        top: 0;
        left: 0;
        width: 2px;
        height: 2px;
        background: white;
        border-radius: 50%;
        box-shadow: 0 0 5px 2px rgba(255, 255, 255, 0.8);
        opacity: 0;
        z-index: -1;
    }
</style>

<script>
    // 修改流星创建频率为0.5-1.5秒
    setInterval(createMeteor, Math.random() * 800 + 400);

    // 同时增加每次创建的流星数量
    function createMeteor() {
        // 随机创建1-3颗流星
        const count = Math.floor(Math.random() * 10) + 1;
        for (let i = 0; i < count; i++) {
            setTimeout(() => {
                const meteor = document.createElement('div');
                meteor.className = 'meteor';

                // 随机位置和角度
                const startX = Math.random() * window.innerWidth;
                const startY = -10;
                const angle = Math.random() * 30 + 15;

                meteor.style.left = startX + 'px';
                meteor.style.top = startY + 'px';

                document.body.appendChild(meteor);

                // 动画参数
                const duration = Math.random() * 1500 + 500; // 0.5-2秒
                const distance = Math.random() * 300 + 200;

                // 动画
                const animation = meteor.animate([
                    { opacity: 0.8, transform: `translate(0, 0)` },
                    { opacity: 0, transform: `translate(${Math.cos(angle * Math.PI / 180) * distance}px, ${Math.sin(angle * Math.PI / 180) * distance}px)` }
                ], {
                    duration: duration,
                    easing: 'linear'
                });

                animation.onfinish = () => meteor.remove();
            }, i * 200); // 每颗流星间隔200ms
        }
    }
</script>

<style>
    /* 设置按钮样式 */
    .settings-btn {
        position: fixed;
        top: 20px;
        right: 20px;
        font-size: 24px;
        cursor: pointer;
        z-index: 100;
        color: white;
        text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
        transition: transform 0.3s;
    }

    .settings-btn:hover {
        transform: rotate(30deg);
    }

    /* 设置弹窗样式 */
    .settings-modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 1000;
        justify-content: center;
        align-items: center;
    }

    .settings-content {
        background: rgba(0, 0, 0, 0.4);
        border-radius: 16px;
        padding: 30px;
        width: 80%;
        max-width: 500px;
        backdrop-filter: blur(10px);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .settings-content h2 {
        color: white;
        margin-top: 0;
        text-align: center;
    }

    .settings-item {
        margin: 20px 0;
    }

    .settings-item label {
        display: block;
        color: rgba(255, 255, 255, 0.8);
        margin-bottom: 8px;
    }

    .settings-item input {
        width: 100%;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.2);
        background: rgba(255, 255, 255, 0.1);
        color: white;
    }

    .settings-actions {
        text-align: center;
        margin-top: 30px;
    }


    /* 更新弹窗动画 */
    .settings-modal {
        display: none;
        opacity: 0;
        transform: scale(0.9);
        transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }

    .settings-modal[style*="flex"] {
        opacity: 1;
        transform: scale(1);
    }

    /* 优化保存按钮样式 */
    .settings-actions button {
        background: linear-gradient(135deg, #4a6bff, #3a56e0);
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 30px;
        cursor: pointer;
        font-weight: 600;
        font-size: 16px;
        transition: all 0.3s ease;
        box-shadow: 0 4px 15px rgba(74, 107, 255, 0.3);
        position: relative;
        overflow: hidden;
        letter-spacing: 1px;
    }

    .settings-actions button::after {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(to right,
                rgba(255, 255, 255, 0.2) 0%,
                rgba(255, 255, 255, 0) 100%);
        transform: translateX(-100%);
        transition: all 0.5s ease;
    }

    .settings-actions button:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 20px rgba(74, 107, 255, 0.4);
    }

    .settings-actions button:hover::after {
        transform: translateX(100%);
    }

    .settings-actions button:active {
        transform: translateY(0);
        box-shadow: 0 4px 10px rgba(74, 107, 255, 0.3);
    }
</style>

<script>
    // 增强设置功能
    function toggleSettings() {
        const modal = document.getElementById('settingsModal');
        if (modal.style.display === 'flex') {
            modal.style.display = 'none';
        } else {
            modal.style.display = 'flex';
            // 加载保存的设置
            const savedApiKey = localStorage.getItem('apiKey');
            if (savedApiKey) {
                document.getElementById('apiKey').value = savedApiKey;
            }
        }
    }

    function saveSettings() {
        const apiKey = document.getElementById('apiKey').value.trim();
        if (!apiKey) {
            alert('请输入有效的API密钥');
            return;
        }

        localStorage.setItem('apiKey', apiKey);
        alert('设置已保存成功');
        toggleSettings();
    }

    // 点击弹窗外部关闭
    document.getElementById('settingsModal').addEventListener('click', function (e) {
        if (e.target === this) {
            toggleSettings();
        }
    });

    // 更新管理聊天记录函数
    function manageChatHistory() {
        // 创建管理弹窗
        const manageModal = document.createElement('div');
        manageModal.style.position = 'fixed';
        manageModal.style.top = '0';
        manageModal.style.left = '0';
        manageModal.style.width = '100%';
        manageModal.style.height = '100%';
        manageModal.style.backgroundColor = 'rgba(0,0,0,0.7)';
        manageModal.style.display = 'flex';
        manageModal.style.justifyContent = 'center';
        manageModal.style.alignItems = 'center';
        manageModal.style.zIndex = '2000';

        // 弹窗内容
        const modalContent = document.createElement('div');
        modalContent.style.background = 'rgba(0,0,0,0.4)';
        modalContent.style.padding = '30px';
        modalContent.style.borderRadius = '16px';
        modalContent.style.width = '80%';
        modalContent.style.maxWidth = '500px';

        // 标题
        const title = document.createElement('h2');
        title.textContent = '管理聊天记录';
        title.style.color = 'white';
        title.style.textAlign = 'center';
        title.style.marginTop = '0';

        // 角色列表
        const characters = ['孔子', '霍去病', '刘邦', '赵云', '丘处机', '樊哙', '曹操'];
        const list = document.createElement('div');

        characters.forEach(character => {
            const item = document.createElement('div');
            item.style.display = 'flex';
            item.style.justifyContent = 'space-between';
            item.style.alignItems = 'center';
            item.style.margin = '15px 0';

            const name = document.createElement('span');
            name.textContent = character;
            name.style.color = 'white';

            const deleteBtn = document.createElement('button');
            deleteBtn.textContent = '删除';
            deleteBtn.style.padding = '8px 16px';
            deleteBtn.style.background = 'rgba(255,0,0,0.5)';
            deleteBtn.style.color = 'white';
            deleteBtn.style.border = 'none';
            deleteBtn.style.borderRadius = '8px';
            deleteBtn.style.cursor = 'pointer';

            deleteBtn.onclick = function () {
                if (confirm(`确定要删除${character}的聊天记录吗？`)) {
                    localStorage.removeItem(`chatHistory_${character}`);
                    alert(`${character}的聊天记录已删除！`);
                    item.remove();
                }
            };

            item.appendChild(name);
            item.appendChild(deleteBtn);
            list.appendChild(item);
        });

        // 关闭按钮
        const closeBtn = document.createElement('button');
        closeBtn.textContent = '关闭';
        closeBtn.style.display = 'block';
        closeBtn.style.margin = '20px auto 0';
        closeBtn.style.padding = '10px 20px';
        closeBtn.style.background = 'rgba(255,255,255,0.1)';
        closeBtn.style.color = 'white';
        closeBtn.style.border = '1px solid rgba(255,255,255,0.2)';
        closeBtn.style.borderRadius = '8px';
        closeBtn.style.cursor = 'pointer';

        closeBtn.onclick = function () {
            document.body.removeChild(manageModal);
        };

        // 组装元素
        modalContent.appendChild(title);
        modalContent.appendChild(list);
        modalContent.appendChild(closeBtn);
        manageModal.appendChild(modalContent);
        document.body.appendChild(manageModal);
    }
</script>

<script>
    // 背景音乐控制
    window.bgm = new Audio();
    window.bgmEnabled = true; // 默认开启音乐
    window.bgm.volume = 0.5; // 设置音量

    // 自动扫描musics文件夹
    function scanMusicFiles() {
        const musicFiles = [
            { name: "不夜城", path: "musics/不夜城.mp3" },
            { name: "蝶飞花舞", path: "musics/蝶飞花舞.mp3" },
            { name: "明镜菩提", path: "musics/明镜菩提.mp3" },
            { name: "纵横天下", path: "musics/纵横天下.mp3" }
        ];
    
        const select = document.getElementById('bgm-select');
        musicFiles.forEach(music => {
            const option = document.createElement('option');
            option.value = music.path;
            option.textContent = music.name;
            select.appendChild(option);
        });
        
        // 默认选择不夜城
        select.value = "musics/不夜城.mp3";
        bgm.src = "musics/不夜城.mp3";
        localStorage.setItem('bgmPath', "musics/不夜城.mp3");
        localStorage.setItem('bgmEnabled', 'true');
    }

    // 尝试自动播放音乐
    function tryAutoPlay() {
        if (bgmEnabled && bgm.src) {
            const playPromise = bgm.play();
            
            if (playPromise !== undefined) {
                playPromise.catch(error => {
                    console.log('自动播放被阻止:', error);
                    // 如果自动播放失败，添加点击事件监听
                    document.body.addEventListener('click', function handleFirstClick() {
                        bgm.play().catch(e => console.log('播放被阻止:', e));
                        document.body.removeEventListener('click', handleFirstClick);
                    }, { once: true });
                });
            }
        }
    }

    // 修改后的DOMContentLoaded事件监听
    document.addEventListener('DOMContentLoaded', () => {
        scanMusicFiles();
        document.getElementById('bgm-toggle').textContent = '开启';
        
        // 1秒后尝试自动播放
        setTimeout(tryAutoPlay, 1000);
        
        // 循环播放
        bgm.addEventListener('ended', () => {
            if (bgmEnabled) {
                bgm.currentTime = 0;
                bgm.play().catch(e => console.log('循环播放被阻止:', e));
            }
        });
    });
    </script>