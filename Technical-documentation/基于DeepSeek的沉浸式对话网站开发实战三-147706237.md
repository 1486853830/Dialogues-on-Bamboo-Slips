<h4>前情提要：从"精装修"到"智能豪宅"的AI对话系统进化史</h4> <br><p>在《基于DeepSeek的沉浸式对话网站开发实战》系列的前两篇中，我们完成了从"毛坯房"到"精装修"的华丽蜕变：</p> <br><p><strong>🔧 第一篇：极简三件套</strong></p> <br><ul><li>用纯HTML+CSS+JavaScript搭建骨架</li><li>通过fetch直接调用DeepSeek API实现跨时空对话</li><li>提示词工程让AI秒变历史人物（如"你现在是李白，要狂放不羁"）</li><li>GitHub Pages一键部署的"丐版"解决方案</li></ul> <br><p><strong>🎨 第二篇：视觉与记忆革命</strong></p> <br><ul><li>聊天气泡动画+角色头像+背景图片，让文字对话变成"会动的画面"</li><li>localStorage实现对话历史持久化，告别"七秒记忆鱼"式聊天</li><li>安全加固：API密钥不再裸奔（虽然具体方案卖了个关子）</li></ul> <br><p>而现在，我们要将这个系统升级成"<strong>智能豪宅</strong>"！</p> <br><hr /> <br><h4>本期内容：</h4> <br><h5>🏠 ​<strong>​【主页实现】​</strong></h5> <br><ul><li>动态角色广场：角色卡片（头像+简单介绍）</li><li>智能体分类：可选择不同类型以查找不同类型智能体</li><li>API密钥输入功能：不再需要在前端写入API-KEY</li></ul> <br><h5>🎵 ​<strong>​【背景音乐功能实现】​</strong></h5> <br><ul><li>情境化音效：匹配角色时代背景的BGM（如李白出现时播放古琴曲）</li></ul> <br><h5>🧠 ​<strong>​【多智能体隔离存储】​</strong></h5> <br><ul><li>角色专属记忆：每个AI角色拥有独立的localStorage命名空间</li></ul> <br><hr /> <br><h4><strong>🏠 主页功能实现</strong></h4> <br><p>这段代码就像是一个"历史人物双面镜"，让我们用有趣的方式来解读它：</p> <br><ol><li> <p>​<strong>威名显赫 vs 名匿青史</strong><br /> 这组选项卡就像历史舞台的聚光灯切换键：</p> <br>  <ul><li>点击"威名显赫"：聚光灯打在曹操、霍去病这些自带光环的历史主角身上</li><li>点击"名匿青史"：灯光照向锦衣卫这些幕后操盘手</li></ul> </li><li> <p>​<strong>卡片设计小心机</strong><br /> 每个角色卡片都是精装的"历史手账"：</p> <pre><code class="language-html"><div class="agent-card" onclick="location.href='...'"><br>    <img src=".../caocaohead.png"> <!-- 曹老板的证件照 --><br>    <div class="agent-desc">...</div> <!-- 微博式简介 --><br></div></code></pre> <p>点击卡片就像打开任意门，直接穿越到角色专属剧场</p> </li><li> <p>​<strong>CSS魔法时刻</strong></p> <code>active</code>类像是给按钮贴"朕已阅"标记</li><li> <p>​<strong>历史梗埋点</strong><br /> 选项卡命名暗藏玄机：</p> <br>  <ul><li>"威名显赫"组都是史书单独列传的大佬</li><li>"名匿青史"组连名字都不配拥有（锦衣卫：我实名举报这个分类！）</li></ul> </li></ol> <br><pre><code class="language-html"><!-- 添加选项卡 --><br>    <div class="tab-container"><br>        <div class="tab-header"><br>            <button class="tab-btn active" onclick="switchTab('characters')">威名显赫</button><br>            <button class="tab-btn" onclick="switchTab('nameless')">名匿青史</button><br>        </div><br><br>        <div id="characters-tab" class="tab-content active"><br>            <!-- 现有的人物卡片容器 --><br>            <div class="agents-container"><br>                <div class="agent-card" onclick="location.href='characters/曹操/caocao.html'"><br>                    <img src="characters/曹操/caocaohead.png" class="agent-avatar" alt="曹操"><br>                    <div class="agent-name">曹操</div><br>                    <div class="agent-desc">曹操，字孟德，小字阿瞒，沛国谯县人，东汉末年丞相、权臣、政治家、军事家、文学家、诗人、书法家，魏王，曹魏政权奠基者。</div><br>                </div><br>                <div class="agent-card" onclick="location.href='characters/霍去病/huoqubing.html'"><br>                    <img src="characters/霍去病/huoqubinghead.png" class="agent-avatar" alt="霍去病"><br>                    <div class="agent-name">霍去病</div><br>                    <div class="agent-desc">霍去病，河东郡平阳县人，西汉时期名将、军事家、民族英雄。</div><br>                </div><br>            </div><br>        </div><br><br>        <div id="nameless-tab" class="tab-content"><br>            <div class="agents-container"><br>                <div class="agent-card" onclick="location.href='characters/锦衣卫/jinyiwei.html'"><br>                    <img src="characters/锦衣卫/jinyiweihead.png" class="agent-avatar" alt="锦衣卫"><br>                    <div class="nameless-name">锦衣卫</div><br>                    <div class="nameless-desc">锦衣卫为明朝特务机构，直属皇帝，掌侍卫、缉捕、刑狱，权势大，对明朝政治影响深远。</div><br>                </div><br>            </div><br>        </div><br><br>    </div></code></pre> <br><pre><code class="language-css">/* 修改背景遮罩层颜色 */<br>body::before {<br>    background: rgba(0, 0, 0, 0.4);<br>    /* 从0.2改为0.4增加黑色浓度 */<br>    backdrop-filter: blur(8px);<br>}<br><br>.agent-card {<br>    background: rgba(0, 0, 0, 0.3);<br>    /* 新增深色卡片背景 */<br>    color: white;<br>    /* 文字改为白色 */<br>}<br><br>.agent-desc {<br>    color: rgba(255, 255, 255, 0.8);<br>    /* 描述文字改为浅灰色 */<br>}<br><br>/* 调整悬停效果透明度 */<br>.agent-card:hover {<br>    background: rgba(255, 255, 255, 0.7);<br>    /* 悬停时稍微减少透明度 */<br>    color: black;<br>    /* 悬停时文字变黑色 */<br>}<br><br>.agent-card:hover .agent-name,<br>.agent-card:hover .agent-desc {<br>    color: black;<br>    /* 确保名称和描述都变黑 */<br>}</code></pre> <br><p><img alt="" height="303" src="https://i-blog.csdnimg.cn/direct/3b049ddac9ce4783be151ee247ed4798.bmp" width="336" /><img alt="" height="302" src="https://i-blog.csdnimg.cn/direct/d3a9531531e2485eb874389318453903.bmp" width="326" /></p> <br><h4><strong>🔑 API密钥安全输入：代码版"藏宝图"</strong></h4> <br><p></p> <br><p>你的API密钥就像<strong>古代虎符</strong>——丢了它，你的AI大军就会变成"无头苍蝇"。来看看这段代码如何用<strong>现代密码学+一点幽默</strong>保护你的密钥：</p> <br><pre><code class="language-javascript">// 1. ​**"虎符"藏宝箱**​（localStorage版）<br>this.API_KEY = localStorage.getItem('apiKey') || ''; <br>// 如果没找到密钥，AI会变成"哑巴将军"（空字符串）<br><br>// 2. ​**锦衣卫密探输入法**​（弹窗版）<br>document.getElementById('api-key-btn').addEventListener('click', () => {<br>    const key = prompt("🗝️ 请输入DeepSeek API密钥：\n（别担心，我们会像保护传国玉玺一样藏好它）");<br>    <br>    if (key) {<br>        localStorage.setItem('apiKey', key); // 塞进"密室"<br>        this.API_KEY = key; // 现在AI能说话了！<br>        alert("密钥已加密存入凌烟阁地下室！");<br>    } else {<br>        alert("⚠️ 您取消了输入，AI将继续保持沉默...");<br>    }<br>});</code></pre> <br><h4>​<strong>代码彩蛋解析</strong> 🥚</h4> <br><ol><li> <p>​<strong><code>localStorage</code> = 大明宝库</strong></p> <br>  <ul><li>比直接写在代码里安全（至少不会被<code>Ctrl+F</code>搜到）</li><li>但依然建议最终升级为<strong>后端代理API</strong>​（相当于派锦衣卫24小时看守）</li></ul> </li><li> <p>​<strong>Prompt弹窗 = 城门守卫</strong></p> 那个可爱的🗝️emoji是故意加的——<strong>黑客看到会愣0.3秒</strong>，给你争取关页面的时间（本人未采用）</li><li> <p>​<strong>空白密钥 = 哑巴模式</strong></p> 如果用户没输入密钥，AI会优雅地闭嘴（而不是报错崩掉）就像<strong>锦衣卫发现假虎符时的沉默</strong></li></ol> <br><h4>​<strong>进阶建议</strong> 🚀</h4> <br><pre><code class="language-javascript">// 3. **​火漆封印"加强版​**（Base64伪装）<br>const saveKey = (key) => {<br>    const sealedKey = btoa(key + "|" + Date.now()); // 加时间戳混淆<br>    localStorage.setItem('apiKey', sealedKey); <br>};<br><br>// 使用时解密<br>const loadKey = () => {<br>    const sealedKey = localStorage.getItem('apiKey');<br>    return sealedKey ? atob(sealedKey).split("|")[0] : ""; // 取出真正的密钥<br>};</code></pre> <br><blockquote> <br> <p>这相当于给虎符裹了一层蜡封，虽然专业黑客还是能破，但能防住<strong>99%的脚本小子</strong></p> <br></blockquote> <br><pre><img alt="" height="191" src="https://i-blog.csdnimg.cn/direct/f2772c8eda924180b0be7e250c29de85.bmp" width="746" /><br></pre> <br><hr /> <br><h4>🎵 ​<strong>背景音乐功能：AI版"宫廷乐师"</strong></h4> <br><h5><strong>1. 角色BGM歌单</strong> 📜</h5> <br><pre><code class="language-javascript">const musicMap = {<br>    '李白': 'guzheng',      // 诗仙出场自带古筝solo<br>    '霍去病': 'battle-drum', // 战神BGM必须是战场擂鼓<br>    '牛顿': 'piano'         // 科学家的优雅钢琴曲<br>};</code></pre> <br><ul><li>​<strong>彩蛋</strong>：如果角色没在歌单里（比如外星人👽），会默默播放<code>default.mp3</code>（可能是《新闻联播》片头曲）</li></ul> <br><hr /> <br><h5>​<strong>2. 音乐开关の小心机</strong> 🔄</h5> <br><pre><code class="language-javascript">audio.loop = true;  // 单曲循环，直到用户崩溃</code></pre> <br><ul><li>像<strong>唐朝宫廷乐师</strong>一样执着："陛下，这首《霓裳羽衣曲》臣能再弹500遍！"</li><li>但比乐师聪明：用<code>audio.paused ? play() : pause()</code>实现<strong>一键静音</strong>，避免被用户赐死（误）</li></ul> <br><hr /> <br><h5>​<strong>3. 隐藏玩法预告</strong> 🎮</h5> <br><pre><code class="language-javascript">// 未来可以加入：<br>audio.volume = 0.3;  // 默认音量调低，防止用户被霍去病的战鼓震聋<br>audio.addEventListener('play', () => {<br>    console.log("🎼 正在播放：" + this.characterName + "主题曲"); <br>    // 偷偷在控制台打印彩蛋日志<br>});</code></pre> <br><blockquote> <br> <p>相当于给BGM加了<strong>史官记录功能</strong>，连播了几次《广陵散》都给你记在小本本上！</p> <br></blockquote> <br><hr /> <br><p><strong>代码示例</strong>：</p> <br><pre><code class="language-javascript">// 根据角色匹配BGM<br>getMusicForCharacter() {<br>    const musicMap = {<br>        '李白': 'guzheng',<br>        '霍去病': 'battle-drum',<br>        '牛顿': 'piano'<br>    };<br>    return musicMap[this.characterName] || 'default';<br>}<br><br>// 音乐控制<br>initMusicControls() {<br>    const audio = new Audio(`/musics/${this.getMusicForCharacter()}.mp3`);<br>    audio.loop = true;<br>    <br>    document.getElementById('music-toggle').addEventListener('click', () => {<br>        audio.paused ? audio.play() : audio.pause();<br>    });<br>}</code></pre> <br><hr /> <br><h4>🧠 ​<strong>多智能体隔离存储：AI版"平行宇宙档案馆"</strong></h4> <br><p>就像给每个历史人物<strong>建了个专属记忆宫殿</strong>，让他们互不干扰，完美实现"<strong>霍去病不懂牛顿力学，牛顿不会背李白的诗</strong>"的史诗级隔离！</p> <br><hr /> <br><h5>​<strong>1. 角色专属命名空间 🏛️</strong></h5> <br><pre><code class="language-javascript">localStorage.setItem(`chatHistory_${this.characterName}`, ...);</code></pre> <br><ul><li>​<strong>相当于</strong>： <br>  <ul><li>给<strong>李白</strong>开个<code>chatHistory_李白</code>文件夹，存他的"醉后语录"</li><li>给<strong>牛顿</strong>开个<code>chatHistory_牛顿</code>文件夹，放他的"苹果砸头日记"</li></ul> </li><li>​<strong>防串戏机制</strong>： <br>  <ul><li>就算你和李白聊到"举杯邀明月"，​<strong>霍去病</strong>也不会突然插话："这月亮适合夜袭匈奴！"</li></ul> </li></ul> <br><hr /> <br><h5>​<strong>2. 跨会话隔离 🚧</strong></h5> <br><pre><code class="language-javascript">loadHistory() {<br>    const savedHistory = localStorage.getItem(`chatHistory_${this.characterName}`);<br>    if (savedHistory) this.messageHistory = JSON.parse(savedHistory);<br>}</code></pre> <br><ul><li>​<strong>相当于</strong>： <br>  <ul><li>每次召唤<strong>霍去病</strong>，系统自动调取他的"作战记录"，不会混进<strong>曹操</strong>的"篡位心得"</li><li>如果没存档（比如第一次聊），AI会乖巧地<strong>从欢迎语开始</strong>，而不是胡言乱语</li></ul> </li></ul> <br><hr /> <br><h5>​<strong>3. 记忆清洗功能 🧹</strong></h5> <br><pre><code class="language-javascript">localStorage.removeItem(`chatHistory_${this.characterName}`);</code></pre> <br><ul><li>​<strong>相当于</strong>： <br>  <ul><li>点"清空历史" = ​<strong>让AI喝下孟婆汤</strong>​（仅限当前角色）</li><li>比如你和<strong>李白</strong>聊崩了，一键删除他的"黑历史"，下次见面他还是那个"仰天大笑出门去"的诗仙</li><li>​<strong>不会误伤</strong>：清空<strong>李白</strong>，​<strong>牛顿</strong>的记忆依然完好无损（科学家的尊严保住了！）</li></ul> </li></ul> <br><hr /> <br><h5>​<strong>4. 隐藏彩蛋 🥚</strong></h5> <br><pre><code class="language-javascript">// 如果未来想搞事情，可以加：<br>localStorage.setItem(`chatHistory_穿越模式`, JSON.stringify([<br>    { role: "system", content: "霍去病和汉武帝在青楼相遇..." }<br>]));</code></pre> <br><ul><li>​<strong>恶趣味</strong>：偷偷建个<code>chatHistory_穿越模式</code>，让<strong>霍去病和汉武帝跨时空对线</strong>​（但正经项目别这么玩😂）</li></ul> <br><p>这段代码用<strong>键值对+角色名后缀</strong>，实现了：</p> <br><ul><li>​<strong>曹操</strong>的奸雄语录 ≠ ​<strong>霍去病</strong>的战场报告</li><li>​<strong>一键删除</strong>某个角色的记忆，不影响其他人</li><li>​<strong>未来扩展</strong>：随时新增角色，自动分配独立记忆库</li></ul> <br><p>就像给每个AI角色发了<strong>专属U盘</strong>，存他们的"人生回忆"，绝不混用！ 🚀</p> <br><p></p> <br><h4>🏁 ​<strong>结语：从代码到穿越，你只差一个回车键</strong></h4> <br><p>在这趟<strong>AI历史穿越之旅</strong>中，我们：</p> <br><ol><li> <p>​<strong>造了时光机</strong></p> <br>  <ul><li>用<code>localStorage</code>给每个古人建了记忆宫殿</li><li>靠<code>fetch</code>从数字长河捞出李白、霍去病们的灵魂碎片</li></ul> </li><li> <p>​<strong>发明了跨次元音响</strong></p> <br>  <ul><li>让古琴声随诗人出场自动播放</li><li>战鼓声在将军说话时自动渐强（虽然代码没写，但你可以脑补）</li></ul> </li><li> <p>​<strong>制定了时空管理局条例</strong></p> <br>  <ul><li>严禁牛顿偷看李白写诗（多智能体隔离存储）</li><li>允许用户一键清除黑历史（比《黑衣人》的记忆消除器还好用）</li></ul> </li></ol> <br><p>欢迎各位大神在评论区交流、讨论、指正、建议、批评</p>