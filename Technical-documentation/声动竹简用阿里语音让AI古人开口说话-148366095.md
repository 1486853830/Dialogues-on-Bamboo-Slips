<h2><strong>ğŸ® å¼•è¯­ï¼šå½“ç«¹ç®€é‡ä¸Šå£°çº¹</strong>â€‹</h2> <br><p>åƒå¹´å‰çš„ç¬”å¢¨ï¼Œä»Šæ—¥çš„å£°æ³¢â€”â€”<strong>å†å²ä»æœªå¦‚æ­¤é²œæ´»ï¼â€‹</strong>â€‹</p> <br><p>æƒ³è±¡ä¸€ä¸‹ï¼š</p> <br><ul><li>â€‹<strong>æç™½</strong>â€‹ ä¸å†åªæ˜¯ã€Œä¸¾æ¯é‚€æ˜æœˆã€çš„æ–‡å­—ï¼Œè€Œæ˜¯ç”¨é†‰æ„æœ¦èƒ§çš„å—“éŸ³ï¼ŒåŸå‡ºã€Œå¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ã€ï¼›</li><li>â€‹<strong>è‹è½¼</strong>â€‹ æŒ¥æ¯«å†™å°±ã€Œå¤§æ±Ÿä¸œå»ã€ï¼ŒåŒæ—¶ç”¨æµ‘åšçš„å£°éŸ³ï¼Œå’Œä½ èŠèŠã€Œèµ¤å£æ€€å¤ã€çš„è±ªæƒ…ï¼›</li><li>â€‹<strong>é­å¾</strong>â€‹ çš„è°è¨€ä¸å†é™é»˜äºå²å†Œï¼Œè€Œæ˜¯ä»¥é“¿é”µè¯­è°ƒï¼Œå½“é¢ã€Œæ¯’èˆŒã€åŠè°â€¦â€¦</li></ul> <br><p>â€‹<strong>â€‹ã€Œå£°åŠ¨ç«¹ç®€ã€â€‹</strong>ï¼Œæ­£æ˜¯è¿™æ ·ä¸€åœºè·¨è¶Šåƒå¹´çš„ã€Œå£°éŸ³å¤æ´»æœ¯ã€ï¼</p> <br><p>æˆ‘ä»¬ç”¨ â€‹<strong>é˜¿é‡Œè¯­éŸ³å¤§æ¨¡å‹</strong>ï¼Œè®© AI å¤äººçœŸæ­£ã€Œå¼€å£è¯´è¯ã€â€”â€”</p> <br><ul><li>â€‹<strong>æ–‡å­—è½¬è¯­éŸ³ï¼ˆTTSï¼‰â€‹</strong>â€‹ ğŸ™ï¸ â†’ æŠŠå²ä¹¦ä¸Šçš„å¥å­ï¼Œå˜æˆæŠ‘æ‰¬é¡¿æŒ«çš„çœŸäººè¯­è°ƒï¼›</li><li>â€‹<strong>è¯­éŸ³é£æ ¼è¿ç§»</strong>â€‹ ğŸ­ â†’ è®©æç™½çš„ç‹‚æ”¾ã€è‹è½¼çš„è±è¾¾ã€é­å¾çš„åˆšç›´ï¼Œéƒ½è—åœ¨å£°çº¿é‡Œï¼›</li><li>â€‹<strong>åŠ¨æ€æƒ…æ„Ÿæ¸²æŸ“</strong>â€‹ ğŸŒŠ â†’ æ ¹æ®å¯¹è¯å†…å®¹ï¼Œè°ƒæ•´è¯­é€Ÿã€è¯­è°ƒï¼Œç”šè‡³åŠ å…¥ç¬‘å£°æˆ–å¹æ¯â€¦â€¦</li></ul> <br><p>â€‹<strong>å†å²äººç‰©ï¼Œä»æ­¤èƒ½ã€Œé—»å…¶å£°ï¼Œå¦‚è§å…¶äººã€ï¼â€‹</strong></p> <br><p></p> <br><hr /> <br><h2>ğŸ’» ç³»ç»Ÿç¯å¢ƒè¦æ±‚ï¼šè®©å†å²ä¹‹å£°å®Œç¾é‡ç°</h2> <br><h4>ğŸ‹ åŸºç¡€èˆå°é…ç½®</h4> <br><ul><li>â€‹<strong>æ“ä½œç³»ç»Ÿ</strong>â€‹ï¼šWindows 10/11ã€macOS 12+ æˆ– Linuxï¼ˆæ¨è Ubuntu 20.04+ï¼‰</li><li>â€‹<strong>Node.js</strong>â€‹ï¼š16.x æˆ–æ›´é«˜ç‰ˆæœ¬ï¼ˆæ¨è 18.x LTSï¼‰</li><li>â€‹<strong>npm/yarn</strong>â€‹ï¼šç¡®ä¿åŒ…ç®¡ç†å™¨ç‰ˆæœ¬æœ€æ–°</li></ul> <br><h4>âš™ï¸ ç¡¬ä»¶éœ€æ±‚</h4> <br><ul><li>â€‹<strong>CPU</strong>â€‹ï¼š4æ ¸èµ·è·³ï¼ˆæ¨è Intel i5/Ryzen 5 æˆ–æ›´é«˜ï¼‰</li><li>â€‹<strong>å†…å­˜</strong>â€‹ï¼š8GB ä¿åº•ï¼ˆ16GB æ›´ä½³ï¼Œè®©å†å²äººç‰©ç•…æ‰€æ¬²è¨€ï¼‰</li><li>â€‹<strong>å­˜å‚¨</strong>â€‹ï¼šè‡³å°‘ 10GB ç©ºé—´ï¼ˆå­˜æ”¾å†å²äººç‰©çš„"å£°éŸ³æ¡£æ¡ˆåº“"ï¼‰</li></ul> <br><h4>ğŸŒ ç½‘ç»œç¯å¢ƒ</h4> <br><ul><li>â€‹<strong>ç¨³å®šå®½å¸¦</strong>â€‹ï¼šâ‰¥5Mbpsï¼ˆç¡®ä¿å†å²äººç‰©ä¸ä¼š"å¡é¡¿ç©¿è¶Š"ï¼‰</li><li>â€‹<strong>é˜²ç«å¢™</strong>â€‹ï¼šå¼€æ”¾ 3000 ç«¯å£ï¼ˆè®©å†å²ä¹‹å£°ç•…é€šæ— é˜»ï¼‰</li><li>â€‹<strong>API å¯†é’¥</strong>â€‹ï¼šå‡†å¤‡å¥½é˜¿é‡Œäº‘è¯­éŸ³åˆæˆæœåŠ¡æƒé™</li></ul> <br><p>å†å²ä¹‹å£°ï¼Œå³å°†åœ¨æ‚¨çš„æœåŠ¡å™¨ä¸Šé‡ç°ï¼å‡†å¤‡å¥½è¿æ¥è¿™åœºè·¨è¶Šåƒå¹´çš„å¯¹è¯äº†å—ï¼Ÿ</p> <br><hr /> <br><h2>å¤©å·¥å¼€éŸ³Â·è¯­éŸ³åˆæˆç³»ç»Ÿè¯¦è§£ ğŸµ</h2> <br><h3>ä¸€ã€å£°éŸµä¹‹é“ï¼šè¯­éŸ³åˆæˆä¸‰è¦è¯€ ğŸ¼</h3> <br><p>å¤«è¯­éŸ³åˆæˆè€…ï¼ŒçŠ¹è‹¥ä¹å¸ˆè°ƒç´ï¼Œéœ€æ˜ä¸‰æ˜§ï¼š</p> <br><ol><li> <p>â€‹<strong>æ‹©å£°</strong>â€‹ï¼šå¦‚é€‰ä¹å™¨</p> <br>  <ul><li>ğŸ» "é¾™åŸ"å£°è‹¥é»„é’Ÿå¤§å•ï¼Œä¼¼è¾¹å…³å·è§’ï¼ˆéœå»ç—…ã€èµµäº‘é€‚ç”¨ï¼‰</li><li>ğŸ¶ "è‰¾é’"éŸ³å¦‚æ¸…å•†é›…ä¹ï¼Œä¼¼æ–‡äººåŸå’ï¼ˆå­”å­ã€æ–‡æˆå…¬ä¸»é€‚ç”¨ï¼‰</li><li>ğŸ¸ "çŸ¥å¤©"éŸµä¼¼é“æ¿é“œç¶ï¼Œè‹¥è±ªä¾ é•¿å•¸ï¼ˆé¡¹ç¾½ã€æ›¹æ“é€‚ç”¨ï¼‰</li></ul> </li><li> <p>â€‹<strong>è°ƒå¾‹</strong>â€‹ï¼šå¦‚è°±å®«å•†</p> <pre><code class="language-javascript">// ğŸ­ é¡¹ç¾½è¯­éŸ³è®¾ç½®<br>{<br>  voice_type: "zhitian_emo", // é“é©¬é‡‘æˆˆä¹‹å£°<br>  rate: 0.95,                // è¯­é€Ÿå¦‚æˆ˜é¼“ç¼“æ“‚<br>  pitch: 0.95,               // éŸ³è°ƒä¼¼æ²‰é›·éšéš<br>  volume: 65                 // éŸ³é‡è‹¥ä¸‡é©¬å¥”è…¾<br>}</code></pre> </li><li> <p>â€‹<strong>æ§éŸ³</strong>â€‹ï¼šä¼¼è°ƒä¸ç«¹</p> <br>  <ul><li>ğŸšï¸ éŸ³é‡è°ƒèŠ‚ï¼š30å¦‚è€³è¯­ï¼Œ50ä¼¼å¸¸è°ˆï¼Œ70è‹¥é›·é¸£</li><li>ğŸ›ï¸ èƒŒæ™¯ä¹é¿è®©ï¼šè¯­éŸ³èµ·æ—¶ä¹å£°æ¸éšï¼ˆ0.3ï¼‰ï¼Œè¯­éŸ³æ­¢æ—¶ä¹å£°å¤èµ·ï¼ˆ1.0ï¼‰</li></ul> </li></ol> <br><h3>äºŒã€å£°çº¿è¯¦è§£ï¼šä¹éŸ³åå…«è°ƒ ğŸ¤</h3> <br><h4>1. é¾™åŸå£°ï¼ˆlongchengï¼‰</h4> <br><ul><li>ğŸ¹ é€‚ç”¨ï¼šæ­¦å°†ã€ç»Ÿå¸…</li><li>ğŸ§ éŸ³è‰²ï¼šæµ‘åšæœ‰åŠ›ï¼Œä¼¼é’é“œç¼–é’Ÿ</li><li>ğŸ“œ ç»å…¸å°è¯ï¼š <pre><code class="language-javascript">{<br>  text: "çŠ¯æˆ‘å¼ºæ±‰è€…ï¼Œè™½è¿œå¿…è¯›ï¼",<br>  rate: 1.1,   // è¯­é€Ÿç¨å¿«æ˜¾å†³å¿ƒ<br>  pitch: 1.05   // éŸ³è°ƒç•¥é«˜å¢æ°”åŠ¿<br>}</code></pre> </li></ul> <br><h4>2. è‰¾é’å£°ï¼ˆaiqingï¼‰</h4> <br><ul><li>ğŸ“š é€‚ç”¨ï¼šæ–‡äººã€è°‹å£«</li><li>ğŸ¼ éŸ³è‰²ï¼šæ¸…äº®å©‰è½¬ï¼Œä¼¼ç‰ç£¬ç‘¶ç´</li><li>ğŸ–‹ï¸ ç»å…¸å°è¯ï¼š <pre><code class="language-javascript">{<br>  text: "å­¦è€Œæ—¶ä¹ ä¹‹ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ",<br>  rate: 0.9,   // è¯­é€Ÿèˆ’ç¼“æ˜¾ä»å®¹<br>  pitch: 1.1    // éŸ³è°ƒæ¸…è¶Šå¦‚æ³‰é¸£<br>}</code></pre> </li></ul> <br><h4>3. çŸ¥å¤©å£°ï¼ˆzhitian_emoï¼‰</h4> <br><ul><li>âš”ï¸ é€‚ç”¨ï¼šè±ªä¾ ã€æ­é›„</li><li>ğŸ¸ éŸ³è‰²ï¼šè·Œå®•èµ·ä¼ï¼Œä¼¼é“æ¿é“œç¶</li><li>ğŸ”¥ ç»å…¸å°è¯ï¼š <pre><code class="language-javascript">{<br>  text: "åŠ›æ‹”å±±å…®æ°”ç›–ä¸–ï¼",<br>  rate: 0.95,  // è¯­é€Ÿæ²‰ç¨³æ˜¾æ‚²å£®<br>  pitch: 0.9    // éŸ³è°ƒä½æ²‰å¢è‹å‡‰<br>}</code></pre> </li></ul> <br><h3>ä¸‰ã€åˆæˆæµç¨‹ï¼šå¤©ç±ç”Ÿæˆæœ¯ ğŸ§</h3> <br><h4>1. å‡€æ–‡æœ¬ï¼ˆå»æ‹¬å·ï¼‰</h4> <br><pre><code class="language-javascript">// ğŸ§¹ å»é™¤åŠ¨ä½œæå†™<br>function stripBrackets(text) {<br>  return text.replace(/ï¼ˆ[^ï¼‰]*ï¼‰|$[^)]*$/g, '');<br>}<br>// ä¾‹ï¼š"é™›ä¸‹ï¼ˆæ‹æ¡ˆå¤§æ€’ï¼‰å²‚æœ‰æ­¤ç†ï¼" â†’ "é™›ä¸‹å²‚æœ‰æ­¤ç†ï¼"</code></pre> <br><h4>2. è¯·å¤©éŸ³ï¼ˆAPIè¯·æ±‚ï¼‰</h4> <br><pre><code class="language-javascript">// ğŸ¹ éœå»ç—…èª“å¸ˆ<br>fetch('/ws-tts', {<br>  method: 'POST',<br>  body: JSON.stringify({<br>    text: "åŒˆå¥´æœªç­ï¼Œä½•ä»¥å®¶ä¸ºï¼",<br>    voice_type: "longcheng",<br>    rate: 1.1,     // ğŸš€ è¯­é€Ÿæ¿€æ˜‚<br>    pitch: 1.05,   // â¬†ï¸ éŸ³è°ƒé“¿é”µ<br>    volume: 70     // ğŸ”Š å£°éœ‡ä¸‰å†›<br>  })<br>});</code></pre> <br><h4>3. æµå¤©ä¹ï¼ˆå®æ—¶æ’­æ”¾ï¼‰</h4> <br><pre><code class="language-javascript">// ğŸ›ï¸ åˆ›å»ºéŸ³æº<br>const mediaSource = new MediaSource();<br>audio.src = URL.createObjectURL(mediaSource);<br><br>// ğŸ§ æ•°æ®åˆ°æ¥å³æ—¶å¥å“<br>sourceBuffer.appendBuffer(audioData); // æ·»éŸ³å…¥æµ<br>audio.play();                         // å£°åŠ¨ä¹éœ„</code></pre> <br><h3>å››ã€è°ƒéŸ³ç§˜ç±ï¼šä¹å¸ˆæ‰‹æœ­ ğŸ“œ</h3> <br><h4>1. æ­¦å°†ä¹‹éŸ³</h4> <br><ul><li>âš”ï¸ è¦è¯€ï¼šå¿«è¯­æ˜¾æœå†³ï¼Œé«˜å£°å£®å†›å¨</li><li>ğŸšï¸ å‚æ•°ï¼š <pre><code class="language-javascript">{<br>  voice_type: "longcheng",<br>  rate: 1.1,     // ç–¾å¦‚ç®­<br>  volume: 65     // å£°å¦‚é›·<br>}</code></pre> </li></ul> <br><h4>2. æ–‡å£«ä¹‹éŸµ</h4> <br><ul><li>ğŸ–‹ï¸ è¦è¯€ï¼šç¼“è¯­æ˜¾ä»å®¹ï¼Œæ¸…éŸ³å½°æ‰æƒ…</li><li>ğŸ›ï¸ å‚æ•°ï¼š <pre><code class="language-javascript">{<br>  voice_type: "aiqing",<br>  rate: 0.9,     // ç¼“ä¼¼æ°´<br>  pitch: 1.1      // æ¸…å¦‚æ³‰<br>}</code></pre> </li></ul> <br><h4>3. å¸ç‹ä¹‹å¨</h4> <br><ul><li>ğŸ‘‘ è¦è¯€ï¼šä¸­é€Ÿæ˜¾å¨ä»ªï¼Œæ²‰éŸ³ç¤ºåº„ä¸¥</li><li>ğŸšï¸ å‚æ•°ï¼š <pre><code class="language-javascript">{<br>  voice_type: "longcheng",<br>  rate: 1.0,     // ç¨³å¦‚å±±<br>  pitch: 1.0      // æ²‰ä¼¼é’Ÿ<br>}</code></pre> </li></ul> <br><h3>äº”ã€å¤©éŸ³èŒƒä¾‹ï¼šå†å²äººç‰©å£°è°± ğŸ­</h3> <br><table><thead><tr><th>äººç‰©</th><th>å£°çº¿ç±»å‹</th><th>è¯­é€Ÿ</th><th>éŸ³è°ƒ</th><th>é€‚ç”¨åœºæ™¯</th><th>ç¤ºä¾‹å°è¯</th></tr></thead><tbody><tr><td>ğŸ¹ éœå»ç—…</td><td>longcheng</td><td>1.1</td><td>1.05</td><td>èª“å¸ˆå‡ºå¾</td><td>"æ„¿å°†è…°ä¸‹å‰‘ï¼Œç›´ä¸ºæ–©æ¥¼å…°ï¼"</td></tr><tr><td>ğŸ“š å­”å­</td><td>aiqing</td><td>0.9</td><td>1.1</td><td>è®²æˆç»å…¸</td><td>"å·±æ‰€ä¸æ¬²ï¼Œå‹¿æ–½äºäººã€‚"</td></tr><tr><td>âš”ï¸ é¡¹ç¾½</td><td>zhitian_emo</td><td>0.95</td><td>0.95</td><td>å“ä¸‹æ‚²æ­Œ</td><td>"è™å…®è™å…®å¥ˆè‹¥ä½•ï¼"</td></tr><tr><td>ğŸŒ¸ æ–‡æˆå…¬ä¸»</td><td>aiqing</td><td>1.05</td><td>1.2</td><td>æ€ä¹¡æŠ’æ€€</td><td>"é•¿å®‰ä¸€ç‰‡æœˆï¼Œä¸‡æˆ·æ£è¡£å£°ã€‚"</td></tr></tbody></table> <br><h3>å…­ã€å¼‚å“å¤„ç†ï¼šå¤©éŸ³ä¿®ä¹ å½• ğŸ› ï¸</h3> <br><ol><li> <p>â€‹<strong>å¼¦æ–­ä¹‹éŸ³</strong>â€‹ï¼ˆæ’­æ”¾é”™è¯¯ï¼‰</p> <pre><code class="language-javascript">audio.onerror = () => {<br>  console.log("ğŸ» ç´å¼¦éª¤æ–­ï¼Œè¯·é‡è¯•");<br>  isSynthesizing = false;<br>};</code></pre> </li><li> <p>â€‹<strong>ä½™éŸ³ç»•æ¢</strong>â€‹ï¼ˆæ’­æ”¾ç»“æŸï¼‰</p> <pre><code class="language-javascript">audio.onended = () => {<br>  setMusicVolume(1.0); // ğŸµ èƒŒæ™¯ä¹æ¸èµ·<br>  isSynthesizing = false;<br>};</code></pre> </li><li> <p>â€‹<strong>æ€¥ç®¡ç¹å¼¦</strong>â€‹ï¼ˆæµå¼ç¼“å†²ï¼‰</p> <pre><code class="language-javascript">sourceBuffer.addEventListener('updateend', () => {<br>  // ğŸ¼ ç»­æ¥éŸ³æµä¸æ–­ç»<br>  sourceBuffer.appendBuffer(newData);<br>});</code></pre> </li></ol> <br><hr /> <br><h3>DashScope API è¯·æ±‚å®Œå…¨æŒ‡å— ğŸš€</h3> <br><h4>ä¸€ã€è®¤è¯é‰´æƒï¼šç„é“ä»¤</h4> <br><pre><code class="language-javascript">// æœ€ä½³å®è·µï¼šåŠ¨æ€ä»¤ç‰Œç®¡ç†<br>class AuthManager {<br>  constructor() {<br>    this.apiKeys = {<br>      primary: 'ds_ä½ çš„ä¸»å¯†é’¥',<br>      backup: 'ds_ä½ çš„å¤‡ç”¨å¯†é’¥',<br>      emergency: 'ds_ç´§æ€¥å¯†é’¥'<br>    };<br>    this.currentKey = this.apiKeys.primary;<br>    this.rotateInterval = setInterval(() => this.rotateKey(), 3600000);<br>  }<br><br>  rotateKey() {<br>    const keys = Object.values(this.apiKeys);<br>    this.currentKey = keys[(keys.indexOf(this.currentKey) + 1) % keys.length];<br>    console.log(`å¯†é’¥è½®æ¢ä¸º: ${this.currentKey.slice(0, 5)}...`);<br>  }<br><br>  getAuthorization() {<br>    return {<br>      headers: {<br>        'Authorization': `Bearer ${this.currentKey}`,<br>        'X-DashScope-Client': 'HistoricalChat/1.0.0'<br>      }<br>    };<br>  }<br>}</code></pre> <br><h4>äºŒã€è¯·æ±‚æ„é€ ï¼šä¸ƒæ˜Ÿå‰‘æ³•</h4> <br><h5>1. åŸºç¡€è¯·æ±‚æ¨¡æ¿</h5> <br><pre><code class="language-javascript">const dashscopeRequest = {<br>  model: "qwen-max-0428",  // æœ€æ–°æ¨¡å‹ç‰ˆæœ¬<br>  input: {<br>    messages: [<br>      {<br>        role: "system",<br>        content: "ä½ æ‰®æ¼”${characterName}ï¼Œä½¿ç”¨${era}æ—¶æœŸçš„è¯­è¨€é£æ ¼..."<br>      },<br>      {<br>        role: "user",<br>        content: "${userMessage}"<br>      }<br>    ]<br>  },<br>  parameters: {<br>    temperature: 0.7,      // æ¨è0.5-1.2åŒºé—´<br>    top_p: 0.8,            // ä¸temperatureäºŒé€‰ä¸€<br>    max_length: 1024,      // æœ€å¤§ç”Ÿæˆé•¿åº¦<br>    repetition_penalty: 1.2,  // é‡å¤æƒ©ç½šç³»æ•°<br>    enable_search: true    // å¯ç”¨è”ç½‘æœç´¢<br>  }<br>};</code></pre> <br><h5>2. å†å²äººç‰©ç‰¹è°ƒå‚æ•°</h5> <br><pre><code class="language-javascript">// éœå»ç—…ä¸“ç”¨é…ç½®<br>const huoQubingConfig = {<br>  parameters: {<br>    temperature: 0.3,      // é™ä½éšæœºæ€§ä¿æŒå¨ä¸¥<br>    presence_penalty: 0.9, // é¿å…è¿‡å¤šä¿®é¥°è¯<br>    stop: ["æœ«å°†å‘Šé€€", "è‡£éµæ—¨"],  // ç‰¹å®šç»“æŸçŸ­è¯­<br>    lexical: {<br>      military_terms: true  // å¯ç”¨å†›äº‹æœ¯è¯­å¢å¼º<br>    }<br>  }<br>};<br><br>// æç™½ä¸“ç”¨é…ç½®<br>const liBaiConfig = {<br>  parameters: {<br>    temperature: 1.1,      // æé«˜åˆ›é€ æ€§<br>    poetic: {<br>      rhyme: "æŠ¼å¹³å£°éŸµ",    // æŠ¼éŸµè®¾ç½®<br>      rhythm: "ä¸ƒè¨€å¾‹è¯—"    // èŠ‚å¥æ¨¡å¼<br>    }<br>  }<br>};</code></pre> <br><h4>ä¸‰ã€æµå¼å“åº”ï¼šä¹æ›²é»„æ²³</h4> <br><h5>1. æ ‡å‡†æµå¼å¤„ç†</h5> <br><pre><code class="language-javascript">async function handleStreamResponse(response) {<br>  const reader = response.body.getReader();<br>  const decoder = new TextDecoder();<br>  let result = '';<br><br>  while (true) {<br>    const { done, value } = await reader.read();<br>    if (done) break;<br><br>    // è§£æSSEæ ¼å¼æ•°æ®<br>    const chunks = decoder.decode(value).split('\n\n');<br>    for (const chunk of chunks) {<br>      if (chunk.startsWith('data:')) {<br>        const data = JSON.parse(chunk.slice(5));<br>        if (data.output?.text) {<br>          result += data.output.text;<br>          process.stdout.write(data.output.text);<br>        }<br>        if (data.usage) {<br>          console.log(`æœ¬æ¬¡æ¶ˆè€—: ${data.usage.total_tokens} tokens`);<br>        }<br>      }<br>    }<br>  }<br>  return result;<br>}</code></pre> <br><h5>2. å¢å¼ºå‹æµæ§</h5> <br><pre><code class="language-javascript">class StreamController {<br>  constructor() {<br>    this.buffer = [];<br>    this.flushInterval = 200; // æ¯«ç§’<br>    this.lastFlush = 0;<br>  }<br><br>  async processStream(stream) {<br>    const reader = stream.getReader();<br>    while (true) {<br>      const { done, value } = await reader.read();<br>      if (done) {<br>        this.flushBuffer(true);<br>        break;<br>      }<br>      <br>      this.buffer.push(value);<br>      const now = Date.now();<br>      if (now - this.lastFlush >= this.flushInterval) {<br>        this.flushBuffer();<br>        this.lastFlush = now;<br>      }<br>    }<br>  }<br><br>  flushBuffer(final = false) {<br>    if (this.buffer.length === 0) return;<br>    <br>    // åˆå¹¶ç¼“å†²åŒºå¹¶å¤„ç†<br>    const merged = mergeBuffers(this.buffer);<br>    const text = decodeText(merged);<br>    <br>    // æ™ºèƒ½åˆ†æ®µå¤„ç†<br>    const sentences = splitSentences(text);<br>    for (const sent of sentences) {<br>      this.renderText(sent);<br>    }<br>    <br>    if (!final) this.buffer = [];<br>  }<br>}</code></pre> <br><h4>å››ã€é”™è¯¯å¤„ç†ï¼šä¹¾å¤å¤§æŒªç§»</h4> <br><h5>1. é”™è¯¯ä»£ç å¤§å…¨</h5> <br><table><thead><tr><th>ä»£ç </th><th>å«ä¹‰</th><th>è§£å†³æ–¹æ¡ˆ</th></tr></thead><tbody><tr><td>400</td><td>å‚æ•°é”™è¯¯</td><td>æ£€æŸ¥input.messagesæ ¼å¼</td></tr><tr><td>401</td><td>è®¤è¯å¤±è´¥</td><td>æ£€æŸ¥APIå¯†é’¥æ˜¯å¦è¿‡æœŸæˆ–æ— æ•ˆ</td></tr><tr><td>429</td><td>è¯·æ±‚é™æµ</td><td>å¯ç”¨è‡ªåŠ¨é€€é¿é‡è¯•æœºåˆ¶</td></tr><tr><td>500</td><td>æœåŠ¡å†…éƒ¨é”™è¯¯</td><td>ç­‰å¾…1åˆ†é’Ÿåé‡è¯•</td></tr><tr><td>503</td><td>æœåŠ¡ä¸å¯ç”¨</td><td>åˆ‡æ¢å¤‡ç”¨APIç«¯ç‚¹</td></tr></tbody></table> <br><h5>2. æ™ºèƒ½é‡è¯•ç­–ç•¥</h5> <br><pre><code class="language-javascript">async function resilientRequest(url, payload, retries = 3) {<br>  const delays = [1000, 3000, 5000]; // é€€é¿é—´éš”<br>  <br>  for (let i = 0; i < retries; i++) {<br>    try {<br>      const response = await fetch(url, {<br>        method: 'POST',<br>        headers: authManager.getAuthorization(),<br>        body: JSON.stringify(payload)<br>      });<br>      <br>      if (response.status === 200) return response;<br>      <br>      // å¤„ç†é™æµ<br>      if (response.status === 429) {<br>        const retryAfter = response.headers.get('Retry-After') || delays[i];<br>        await new Promise(res => setTimeout(res, retryAfter));<br>        continue;<br>      }<br>      <br>      throw new Error(`HTTP ${response.status}`);<br>      <br>    } catch (error) {<br>      if (i === retries - 1) throw error;<br>      await new Promise(res => setTimeout(res, delays[i]));<br>    }<br>  }<br>}</code></pre> <br><h4>å…­ã€ç‰¹åˆ«æŠ€å·§ï¼šç‹¬å­¤ä¹å‰‘</h4> <br><ol><li>â€‹<strong>æ–‡è¨€æ–‡å¢å¼º</strong>â€‹ï¼šåœ¨parametersä¸­æ·»åŠ  <code>"classical_chinese": true</code> å¯æå‡å¤æ–‡ç”Ÿæˆè´¨é‡</li><li>â€‹<strong>å¤šè½®å¯¹è¯å‹ç¼©</strong>â€‹ï¼šä½¿ç”¨ <code>"message_compression": true</code> è‡ªåŠ¨ç²¾ç®€å†å²å¯¹è¯</li><li>â€‹<strong>å®æ—¶é£æ ¼è°ƒæ•´</strong>â€‹ï¼šé€šè¿‡ <code>"style": "strict"</code> å¯åˆ‡æ¢ä¸¥è°¨/åˆ›æ„æ¨¡å¼</li><li>â€‹<strong>æ•æ„Ÿè¯è¿‡æ»¤</strong>â€‹ï¼šé…ç½® <code>"safety_filter": {"level": "strict"}</code> é¿å…ä¸å½“å†…å®¹</li><li>â€‹<strong>å¤šæ¨¡æ€æ‰©å±•</strong>â€‹ï¼šæ·»åŠ  <code>"multimodal": {"images": true}</code> å¯ç”¨å›¾åƒç†è§£èƒ½åŠ›</li></ol> <br><hr /> <br><h3>ç»“è¯­ï¼šå¤©å·¥å¼€ç‰©ï¼Œå£°åŠ¨å¤ä»Š ğŸ‡</h3> <br><p>æ­¤è¯­éŸ³åˆæˆç³»ç»Ÿï¼Œèç°ä»£ç§‘æŠ€äºä¼ ç»Ÿå£°éŸµï¼š</p> <br><ul><li>ğŸ¨ ä»¥ä»£ç ä¸ºè°±ï¼Œå¥å†å²å¼ºéŸ³</li><li>ğŸ¤– å€ŸAIä¹‹åŠ›ï¼Œå¤æ´»å¤äººå£°è…”</li><li>ğŸ­ è®©éœå»ç—…çš„è±ªè¿ˆã€å­”å­çš„ç¿æ™ºã€é¡¹ç¾½çš„æ‚²æ€†ã€æ–‡æˆçš„æŸ”å©‰ï¼Œçš†å¯é—»äºè€³è€Œæ„Ÿäºå¿ƒ</li></ul> <br><p>è¯¸å›ä¸å¦¨ä¸€è¯•ï¼Œä¸åƒå¤é£æµäººç‰©ï¼ŒæŠŠé…’è¨€æ¬¢ï¼Œä¿ƒè†é•¿è°ˆï¼ ğŸ¶ğŸ¶</p> <br><div class="csdn-video-box" data-report-view="{"spm":"3001.10261","extra":{"id":"SFC2c9WG-1748761414133"}}"> <br> <iframe id="SFC2c9WG-1748761414133" frameborder="0" src="https://live.csdn.net/v/embed/479518" allowfullscreen="true" data-mediaembed="csdn"></iframe> <br> <p>é’ç®€é—®å¯¹Â·æ²‰æµ¸å¼AIå¯¹è¯</p> <br></div> <br><hr />