<h3>🏠 引语：</h3> <br><p>​当<strong>李白</strong>遇上<strong>霍去病</strong> ⚔️，当<strong>DeepSeek的求索精神 🔍</strong> 碰撞<strong>通义千问的万象包容 🌌</strong>——这场跨越时空与技术的对话盛宴，终于迎来它的融合形态！✨**​</p> <br><p>在<strong><a class="link-info" href="https://blog.csdn.net/h1486853830/category_12962511.html" title="《沉浸式对话网站开发实战》">《沉浸式对话网站开发实战》</a></strong>系列的前四篇中，我们从“毛坯房”🏚️ 到“智能豪宅”🏰，用DeepSeek的API唤醒了历史长河中的灵魂碎片：</p> <br><ul><li>​<strong>第一幕</strong>​ 🎬：用三行代码撬动AI江湖，让李白举着JavaScript的酒杯吟诗；</li><li>​<strong>第二幕</strong>​ 🎭：为古人装上localStorage记忆宫殿 🧠，再健忘的AI也不会忘记你的吐槽；</li><li>​<strong>第三幕</strong>​ 🎪：角色广场+时空BGM 🎵，把聊天界面变成历史人物主题乐园；</li><li>​<strong>第四幕</strong>​ 🎨：让牛顿真的能和你聊《自然哲学的数学原理》……</li></ul> <br><p>而今天，我们要<strong>打破“单模型霸权”💥！​</strong>​<br /> ​<strong>为什么选择通义千问？🤔</strong>​</p> <br><ul><li>当<strong>DeepSeek的严谨推理 🧮</strong> 遇上<strong>通义千问的创意发散 🎨</strong>，就像让霍去病的战术头脑 🎯 和苏轼的随性豁达 🍃 同台竞技；</li><li><strong>双模型API自由选择</strong>——在前端决定今晚陪你聊天的是“理工直男版牛顿”🤓 还是“文艺青年版徐霞客”🌿；</li><li>价格对冲策略 💰：深夜用DeepSeek（<strong>有优惠</strong>），白天切通义千问（免费额度更慷慨），让API账单从此“<strong>能屈能伸</strong>”💪。</li></ul> <br><p>​<strong>你将学到这些“骚操作”🔥：​</strong>​</p> <br><ol><li>​<strong>双模型负载均衡 ⚖️</strong>​：用浏览器指纹自动分配API，防止某家服务器卡成PPT 🐌；</li><li>​<strong>人设PK实验场 🥊</strong>​：同一段提示词分别喂给DeepSeek和通义千问，看哪个AI更适合扮演“毒舌魏征”🗡️；</li></ol> <br><h5><strong>🛠️ 开发环境准备</strong></h5> <br><p>在开始这场双模型对话盛宴前，请确保你的开发环境已经武装到牙齿：</p> <br><pre><code class="language-bash"># 初始化Node.js项目<br>npm init -y<br><br># 安装核心依赖<br>npm install express cors axios dotenv<br># express - 构建后端服务器<br># cors - 解决跨域问题<br># axios - 优雅地调用API<br># dotenv - 安全存储API密钥<br><br># 可选开发依赖<br>npm install nodemon --save-dev<br># 热重载开发更高效</code></pre> <br><h3>✨ ​ <strong>开发思路</strong></h3> <br><ol><li> <p>​<strong>前端：茶馆跑堂小二</strong>​ 👨🍳</p> <br>  <ul><li>"客官您请~"（优雅鞠躬）</li><li>转身对厨房咆哮："2号桌要杯'量子龙井'，加冰🧊！"</li><li>（内心OS：不就是把JSON当外卖单送嘛）</li></ul> </li><li> <p>​<strong>Express：太极宗师</strong>​ 🧘</p> <br>  <ul><li>左手画圆接剑气⚔️（DeepSeek）</li><li>右手画方转茶香🍃（千问）</li><li>最后用<code>res.json()</code>搓成汤圆🍡</li></ul> <pre><code class="language-javascript">// 伪代码の禅意<br>function 阴阳调和(response) {<br>    return response.data || "大师今日闭关🤫";<br>}</code></pre> </li><li> <p>​<strong>适配层：精分现场</strong>​ 🤪</p> <br>  <ul><li>对DeepSeek："兄dei，按OpenAI规矩来！"📜</li><li>对千问："客官稍等，给您套个阿里特供茶具🍶"</li></ul> <pre><code class="language-javascript">const 煮茶秘方 = {<br>    input: { messages },  // 阿里式俄罗斯套娃<br>    parameters: {         // 火候控制<br>        temperature: 0.8, // 文火🔥<br>        seed: 42          // 宇宙真理🌌<br>    }<br>};</code></pre> </li><li> <p>​<strong>统一输出：江湖规矩</strong>​ ⚖️</p> <br>  <ul><li>管你是剑气还是茶香💨</li><li>统统装进<code>{content:"",role:"AI"}</code>的青花瓷碗🥣</li><li>（用户：这碗今天怎么有铁锈味？🤔）</li></ul> </li></ol> <br><p>💡 ​<strong>程序员忠告</strong>​ 💡<br /> 开发本程序可能导致：</p> <br><ol><li>人格分裂倾向 🔀</li><li>在代码里找茶叶的幻觉🌿</li><li>把API报错当对联欣赏📜</li></ol> <br><p>（建议常备🍵和⌨️两套装备，以防走火入魔）</p> <br><p><img alt="" height="1148" src="https://i-blog.csdnimg.cn/direct/6585dadf86af4d8586f7d59161485450.png" width="740" /></p> <br><hr /> <br><h3>🏮 锦衣卫密档：API切换管理功能 🏮</h3> <br><h4>📜 镇抚司密令</h4> <br><pre><code class="language-javascript">// 南北镇抚司令牌切换之术<br>function 令牌切换() {<br>    const 上峰手谕 = document.getElementById('apiProvider').value;<br>    document.getElementById('deepseekApiItem').style.display = 上峰手谕 === 'deepseek' ? 'block' : 'none';<br>    document.getElementById('qianwenApiItem').style.display = 上峰手谕 === 'qianwen' ? 'block' : 'none';<br>}<br><br>// 封存密档之法<br>function 封存密档() {<br>    // 验明正身<br>    const 指挥使手令 = document.getElementById('apiProvider').value;<br>    localStorage.setItem('apiProvider', 指挥使手令);<br><br>    // 依令封存对应密函<br>    if (指挥使手令 === 'deepseek') {<br>        const 北司令牌 = document.getElementById('apiKey').value.trim();<br>        if (!北司令牌) {<br>            alert('北镇抚司令牌不可为空！');<br>            return;<br>        }<br>        localStorage.setItem('apiKey', 北司令牌);<br>    } else {<br>        const 南司令牌 = document.getElementById('qianwenApiKey').value.trim();<br>        if (!南司令牌) {<br>            alert('南镇抚司令牌不可为空！');<br>            return;<br>        }<br>        localStorage.setItem('qianwenApiKey', 南司令牌);<br>    }<br>    alert('密档已封存！');<br>    令牌切换();<br>}<br><br>// 调阅密档之术<br>function 调阅密档() {<br>    // ...其他机密...<br>    <br>    // 查验过往手令<br>    const 前任手令 = localStorage.getItem('apiProvider') || 'deepseek';<br>    document.getElementById('apiProvider').value = 前任手令;<br>    令牌切换();<br>    <br>    // 依令取对应密函<br>    if (前任手令 === 'deepseek') {<br>        const 前任北司令 = localStorage.getItem('apiKey');<br>        if (前任北司令) document.getElementById('apiKey').value = 前任北司令;<br>    } else {<br>        const 前任南司令 = localStorage.getItem('qianwenApiKey');<br>        if (前任南司令) document.getElementById('qianwenApiKey').value = 前任南司令;<br>    }<br>    <br>    // ...其他机密...<br>}</code></pre> <br><h4>🔐 指挥使批注</h4> <br><ol><li> <p>​<strong>​"令牌切换"之术</strong>​<br /> 🏛️ 此术如南北镇抚司令牌更替，持北镇抚司令则开北司密匣，持南镇抚司令则启南司密匣<br /> 🚪 两司密匣从不同时开启，防奸细窥探</p> </li><li> <p>​<strong>​"封存密档"之法</strong>​<br /> 🗃️ 将密令藏于<code>localStorage</code>此"诏狱密柜"中<br /> 🛡️ 若遇空令牌，则如城门校尉拦驾："令牌不可空！"</p> </li><li> <p>​<strong>​"调阅密档"之术</strong>​<br /> 📖 每调阅必先查前任指挥使手令<br /> 🔍 得手令便知当开何司密匣</p> </li></ol> <br><h4><strong>🔍 代码片段（通义千问相关）​</strong>​</h4> <br><pre><code class="language-javascript">const getApiProvider = () => localStorage.getItem('apiProvider') || 'deepseek'; // 默认是deepseek<br>const getApiKey = () => {<br>    const provider = getApiProvider();<br>    return provider === 'deepseek' <br>        ? localStorage.getItem('apiKey') <br>        : localStorage.getItem('qianwenApiKey'); // 如果是通义千问，就掏它的专属钥匙<br>};<br><br>async function sendMessage() {<br>    const apiProvider = getApiProvider(); // 看看今天用哪家AI<br>    const apiKey = getApiKey(); // 摸对应的钥匙<br>    const response = await fetch("http://localhost:3000/sendMessage", {<br>        body: JSON.stringify({ apiProvider, apiKey, messageHistory }) // 把AI类型和钥匙一起打包<br>    });<br>    const data = await response.json();<br>    const botResponse = apiProvider === 'deepseek' <br>        ? data.choices[0].message.content <br>        : data.output.text; // 通义千问的回复藏在 `output.text` 里<br>}</code></pre> <br><hr /> <br><h4>​<strong>🎤 趣味解读（通义千问の奇妙冒险）​</strong>​</h4> <br><h5>​<strong>1. <code>getApiProvider()</code> —— “今天宠幸哪个AI？”​</strong>​</h5> <br><ul><li>这函数就像 ​<strong>皇上翻牌子</strong>，默认临幸 <code>deepseek</code>，但用户偷偷藏了 <code>qianwen</code> 的绿头牌（<code>localStorage</code>）。</li></ul> <br><h5>​<strong>2. <code>getApiKey()</code> —— “AI 的钥匙管家”​</strong>​</h5> <br><ul><li>如果用户选了 <code>deepseek</code>，就掏 <code>apiKey</code>（普通钥匙）。</li><li>但如果选了 ​<strong>通义千问</strong>，就摸 <code>qianwenApiKey</code>（VIP 金钥匙🔑）。</li></ul> <br><h5>​<strong>3. <code>sendMessage()</code> —— “AI 快递员的分拣中心”​</strong>​</h5> <br><ul><li>把 <code>apiProvider</code> 和 <code>apiKey</code> 打包，像外卖订单一样发给后端： <br>  <ul><li>​<strong>DeepSeek</strong>​ 的回复在 <code>data.choices[0].message.content</code>（藏在“菜篮子”里）。</li><li>​<strong>通义千问</strong>​ 的回复却在 <code>data.output.text</code>（藏在“快递箱夹层”里）。</li></ul> </li></ul> <br><hr /> <br><h3>🏯 千问阁密录：通义仙机调用宝典 🏯</h3> <br><h4>🎋 通玄密钥篇</h4> <br><pre><code class="language-javascript">const apiKey = req.body.apiKey; // 仙机密钥<br>const baseUrl = "https://dashscope.aliyuncs.com/api/v1/services/aigc/text-generation/generation"; // 通义仙阁<br>const headers = {<br>    "Content-Type": "application/json", // 符箓格式<br>    "Authorization": `Bearer ${apiKey}` // 通玄令牌<br>};</code></pre> <br><p>🀄 此乃调用通义仙机之"通关符咒"！密钥如丹书铁券，仙阁似洞天福地，需持此符咒方可叩开仙门~ 🧿</p> <br><h4>🦚 仙鹤传音篇</h4> <br><pre><code class="language-javascript">response = await axios.post(baseUrl, {<br>    model: "qwen-max", // 启用千问仙机<br>    input: {<br>        messages: messageHistory // 呈递对话玉简<br>    },<br>    parameters: {<br>        temperature: 0.8, // 灵性火候<br>        top_p: 0.8 // 真言纯度<br>    }<br>}, { headers });</code></pre> <br><p>🪶 此乃"仙鹤传音"秘术！将对话玉简呈递通义仙机，以灵性火候控其文采，以真言纯度制其辞章~ 🌈 仙机运转，必生锦绣天书！</p> <br><h4>🎎 仙缘初会篇</h4> <br><pre><code class="language-javascript">response = await axios.post(baseUrl, {<br>    model: "qwen-max", // 通义仙机待诏<br>    input: {<br>        messages: [{<br>            role: "system",<br>            content: `作为${characterName}，问候${userName}...`<br>        }]<br>    },<br>    parameters: {<br>        temperature: 0.8, // 仙缘亲密度<br>        top_p: 0.8 // 礼数周天度<br>    }<br>}, { headers });</code></pre> <br><p>🎋 此乃"仙缘初会"之仪！通义仙机化身characterName，以亲和之姿执礼，向{userName}道仙安~ 🧧</p> <br><h4>🎏 三才妙应篇</h4> <br><pre><code class="language-javascript">response = await axios.post(baseUrl, {<br>    model: "qwen-max", // 仙机显圣<br>    input: {<br>        messages: [<br>            ...messageHistory,<br>            {<br>                role: "user",<br>                content: `请生成3个回复选项...`<br>            }<br>        ]<br>    },<br>    parameters: {<br>        temperature: 1, // 灵机活泼度<br>        top_p: 0.8 // 应对天机数<br>    }<br>}, { headers });</code></pre> <br><p>🎴 此乃"三才妙应"玄法！通义仙机灵光乍现，献天地人三策，供君择选，暗合三才之道~ 🪷</p> <br><h4>🪔 仙谕回传篇</h4> <br><pre><code class="language-javascript">const qianwenResponse = response.data.output.text; // 取得仙谕<br>res.json({ output: { text: qianwenResponse } }); // 下传凡尘</code></pre> <br><p>📿 此乃"仙谕回传"之术！取得通义仙机之谕示，以天书格式封装，下传凡尘~ 🌠 正所谓："仙机一动，天书自显"！</p> <br><hr /> <br><h2>🎪 大宋驿站开张记：Node.js 版 🎪</h2> <br><pre><code class="language-javascript">const path = require('path');  // 请来"指南车"师傅<br>app.use(express.static(path.join(__dirname)));  // 🏗️ 搭建露天货摊</code></pre> <br><h3>🎭 代码江湖演义</h3> <br><ol><li> <p>​<strong>​"指南车"师傅进场</strong>​ 🧭</p> <br>  <ul><li><code>path</code> 模块就像大宋最牛的"指南车"工匠</li><li>专治各种："我的货物到底堆在哪个坊市？"的路痴问题</li><li>此刻正在用<code>__dirname</code>测量驿站精确坐标（当前目录）</li></ul> </li><li> <p>​<strong>露天货摊开张</strong>​ 🏮</p> <br>  <ul><li><code>express.static()</code>好比在驿站门口支起的货摊</li><li>把HTML/CSS/JS这些"丝绸瓷器"直接摆出来卖</li><li>路过客商（浏览器）可以直接取用，不用通关文牒！</li></ul> </li><li> <p>​<strong>驿丞大人升堂</strong>​ 🏛️</p> <pre><code class="language-javascript">app.listen(port, () => {<br>    console.log(`🏮 驿站已在${port}号官道开张 🏮`);<br>});</code></pre> <br>  <ul><li>驿丞（Node.js）一甩惊堂木："升——堂——"</li><li>衙役们（线程）立刻在<code>3000</code>号官道两侧列队</li><li>账房先生（console）挥毫记下开张时辰</li></ul> </li></ol> <br><h3>🐎 启动秘籍</h3> <br><ol><li>备好<strong>通关文牒</strong>​（安装Node.js）</li><li>在驿站门口（终端）大喝一声： <pre><code class="language-bash">node server.js  # 🗡️ 宝剑出鞘！</code></pre> </li><li>若见红绸飘动（console输出），便是吉时已到： <pre><code class="language-bash">🏮 驿站已在3000号官道开张 🏮</code></pre> </li></ol> <br><h3>💡 江湖经验</h3> <br><ul><li>这个"货摊"只卖<strong>静态货物</strong>​（前端三件套）</li><li>想交易<strong>动态货物</strong>​（API接口）得找后面的库房（路由）</li><li>突然闭市？定是有刁民（bug）击鼓鸣冤！</li></ul> <br><blockquote> <br> <p>小贴士：现代"驿站"可比大宋先进多啦～不用喂马匹，只需喂代码！ 🍵</p> <br></blockquote> <br><p></p> <br><p><img alt="" height="1720" src="https://i-blog.csdnimg.cn/direct/7147932ddfd2486e924868f3d3b4c937.png" width="1181" /></p> <br><hr /> <br><h3>补：通义千问大模型选择指南</h3> <br><h4>🏯 通义千问·天机价目时辰谱 🏯</h4> <br><table><thead><tr><th>​<strong>法宝品级</strong>​</th><th>​<strong>模型名称</strong>​</th><th>​<strong>参数量级</strong>​</th><th>​<strong>千字灵石价（￥）​</strong>​</th><th>​<strong>响应时辰（毫秒）​</strong>​</th><th>​<strong>玄妙特性</strong>​</th><th>​<strong>适宜场景</strong>​</th></tr></thead><tbody><tr><td>🌟 ​<strong>天阶上品</strong>​</td><td>Qwen-Max</td><td>千亿级</td><td>0.12</td><td>1200-1800</td><td>文冠三界，理通万物</td><td>御前奏对、锦绣文章</td></tr><tr><td>🏅 ​<strong>天阶中品</strong>​</td><td>Qwen-Plus</td><td>百亿级</td><td>0.08</td><td>800-1200</td><td>才思敏捷，应对如流</td><td>日常问答、诗词唱和</td></tr><tr><td>🎯 ​<strong>地阶上品</strong>​</td><td>Qwen-Turbo</td><td>十亿级</td><td>0.04</td><td>400-700</td><td>迅捷如风，言简意赅</td><td>市井闲谈、即时应对</td></tr><tr><td>🏮 ​<strong>玄阶秘传</strong>​</td><td>Qwen-1.8B</td><td>18亿</td><td>0.02</td><td>200-500</td><td>小巧玲珑，暗藏玄机</td><td>凡间器物、袖里乾坤</td></tr><tr><td>🪶 ​<strong>黄阶基础</strong>​</td><td>Qwen-7B</td><td>70亿</td><td>0.03</td><td>300-600</td><td>根基扎实，中正平和</td><td>蒙学开智、粗浅问答</td></tr></tbody></table> <br><hr /> <br><h4>🧙‍♂️ ​<strong>价格时辰详解</strong>​ 🧙‍♀️</h4> <br><ol><li> <p>​<strong>Qwen-Max</strong>​</p> <br>  <ul><li>​<strong>价</strong>​：0.12元/千token（如《滕王阁序》全文约合￥0.15）</li><li>​<strong>时</strong>​：1.2-1.8秒（相当于三句茶歇）</li><li>​<strong>例</strong>​：生成圣旨诏书，慢工出细活</li></ul> </li><li> <p>​<strong>Qwen-Plus</strong>​</p> <br>  <ul><li>​<strong>价</strong>​：Max的六成（￥0.08/千token）</li><li>​<strong>时</strong>​：0.8-1.2秒（快于磨墨时间）</li><li>​<strong>例</strong>​：青楼即兴赋诗，价时两宜</li></ul> </li><li> <p>​<strong>Qwen-Turbo</strong>​</p> <br>  <ul><li>​<strong>价</strong>​：仅Max三成（￥0.04/千token）</li><li>​<strong>时</strong>​：疾如飞矢（400-700毫秒）</li><li>​<strong>例</strong>​：驿站快马传书，争分夺秒</li></ul> </li><li> <p>​<strong>Qwen-1.8B</strong>​</p> <br>  <ul><li>​<strong>价</strong>​：白菜价（￥0.02/千token）</li><li>​<strong>时</strong>​：眨眼之间（200-500毫秒）</li><li>​<strong>例</strong>​：童蒙识字卡片，小巧够用</li></ul> </li><li> <p>​<strong>Qwen-7B</strong>​</p> <br>  <ul><li>​<strong>价</strong>​：略高于1.8B（￥0.03/千token）</li><li>​<strong>时</strong>​：中庸之道（300-600毫秒）</li><li>​<strong>例</strong>​：市井布告文书，平衡之选</li></ul> </li></ol> <br><hr /> <br><h4>🏮 ​<strong>择选心诀</strong>​ 🏮</h4> <br><ol><li>​<strong>不差钱要体面</strong>​：Max慢工雕龙画凤</li><li>​<strong>性价两全</strong>​：Plus文武双全</li><li>​<strong>快字当头</strong>​：Turbo飞鸽传书</li><li>​<strong>锱铢必较</strong>​：1.8B小器大用</li></ol> <br><blockquote> <br> <p>📜 ​<strong>注</strong>​：</p> <br> <ul><li>价格参照阿里云2024年端阳节报价（商业版）</li><li>响应时辰受<strong>天时（服务器负载）​</strong>、<strong>地利（网络状况）​</strong>、<strong>人和（请求复杂度）​</strong>三才影响</li><li>凡调用超<strong>万字长篇</strong>，建议焚香沐浴后分批奏请，防仙机过劳崩殂</li></ul> <br></blockquote> <br><p>（本谱暗合通义千问最新天机，实际威能请以仙官符诏为准）</p> <br><p><strong>欢迎各位在评论区交流讨论</strong></p> <br><p></p>